<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Asset Protocol - Alloverse Documentation</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Asset Protocol | Alloverse Documentation</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="Asset Protocol" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Getting started with Alloverse. Guides, code snippets, API references…" /> <meta property="og:description" content="Getting started with Alloverse. Guides, code snippets, API references…" /> <link rel="canonical" href="/protocol-reference/asset-protocols" /> <meta property="og:url" content="/protocol-reference/asset-protocols" /> <meta property="og:site_name" content="Alloverse Documentation" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Asset Protocol" /> <script type="application/ld+json"> {"description":"Getting started with Alloverse. Guides, code snippets, API references…","url":"/protocol-reference/asset-protocols","@type":"WebPage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/images/Alloverse01.png"}},"headline":"Asset Protocol","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Get Started</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/concepts" class="nav-list-link">Concepts</a><ul class="nav-list "><li class="nav-list-item "><a href="/concepts/architecture" class="nav-list-link">Alloverse Architecture</a></li><li class="nav-list-item "><a href="/concepts/points-pokes-and-grabs" class="nav-list-link">Points, Pokes and Grabs</a></li><li class="nav-list-item "><a href="/concepts/writing-apps-with-alloUI" class="nav-list-link">Writing apps with AlloUI</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/examples" class="nav-list-link">Examples</a><ul class="nav-list "><li class="nav-list-item "><a href="/concepts/animating-views" class="nav-list-link">Animating Views</a></li><li class="nav-list-item "><a href="/concepts/assets" class="nav-list-link">Assets</a></li></ul></li><li class="nav-list-item"><a href="/hig" class="nav-list-link">3D Human Interface Guidelines</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/classes/" class="nav-list-link">Classes</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="/modules/" class="nav-list-link">Modules</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/protocol-reference" class="nav-list-link">Protocol Reference</a><ul class="nav-list "><li class="nav-list-item active"><a href="/protocol-reference/asset-protocols" class="nav-list-link active">Asset Protocol</a></li><li class="nav-list-item "><a href="/protocol-reference/coordinate-system" class="nav-list-link">Coordinate System</a></li><li class="nav-list-item "><a href="/protocol-reference/identity" class="nav-list-link">Identity</a></li><li class="nav-list-item "><a href="/protocol-reference/intent" class="nav-list-link">Intent</a></li><li class="nav-list-item "><a href="/protocol-reference/interactions" class="nav-list-link">Interactions</a></li><li class="nav-list-item "><a href="/protocol-reference/official-components" class="nav-list-link">Official Components</a></li><li class="nav-list-item "><a href="/protocol-reference/state-diffs" class="nav-list-link">State Diffs</a></li><li class="nav-list-item "><a href="/protocol-reference/url-definitions" class="nav-list-link">URL Definitions</a></li><li class="nav-list-item "><a href="/protocol-reference/wire-protocol" class="nav-list-link">Wire Protocol</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/community" class="nav-list-link">Community</a><ul class="nav-list "><li class="nav-list-item "><a href="/community/contributing" class="nav-list-link">Contributing to Alloverse</a></li><li class="nav-list-item "><a href="/community/code-of-conduct.html" class="nav-list-link">Code of Conduct</a></li><li class="nav-list-item "><a href="/community/licenses" class="nav-list-link">Licenses used by Alloverse</a></li><li class="nav-list-item "><a href="/community/alloverse-license.html" class="nav-list-link">Alloverse License</a></li></ul></li><li class="nav-list-item"><a href="/doc/classes/Asset.html" class="nav-list-link">Asset</a></li><li class="nav-list-item"><a href="/doc/classes/AssetManager.html" class="nav-list-link">AssetManager</a></li><li class="nav-list-item"><a href="/doc/classes/AssetView.html" class="nav-list-link">AssetView</a></li><li class="nav-list-item"><a href="/doc/classes/Base64Asset.html" class="nav-list-link">Base64Asset</a></li><li class="nav-list-item"><a href="/doc/classes/Button.html" class="nav-list-link">Button</a></li><li class="nav-list-item"><a href="/doc/classes/FileAsset.html" class="nav-list-link">FileAsset</a></li><li class="nav-list-item"><a href="/doc/classes/GrabHandle.html" class="nav-list-link">GrabHandle</a></li><li class="nav-list-item"><a href="/doc/" class="nav-list-link">Index</a></li><li class="nav-list-item"><a href="/doc/classes/Label.html" class="nav-list-link">Label</a></li><li class="nav-list-item"><a href="/doc/classes/Speaker.html" class="nav-list-link">Speaker</a></li><li class="nav-list-item"><a href="/doc/classes/Surface.html" class="nav-list-link">Surface</a></li><li class="nav-list-item"><a href="/doc/classes/TextField.html" class="nav-list-link">TextField</a></li><li class="nav-list-item"><a href="/doc/classes/View.html" class="nav-list-link">View</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.include.allonet.assetstore.html" class="nav-list-link">allonet.include.allonet.assetstore</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.include.allonet.client.html" class="nav-list-link">allonet.include.allonet.client</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.include.allonet.jobs.html" class="nav-list-link">allonet.include.allonet.jobs</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.include.allonet.state.html" class="nav-list-link">allonet.include.allonet.state</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.lang.lua.allonet-lua.html" class="nav-list-link">allonet.lang.lua.allonet-lua</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.lang.lua.json.html" class="nav-list-link">allonet.lang.lua.json</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.lang.lua.lua-utils.html" class="nav-list-link">allonet.lang.lua.lua-utils</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.src.asset.html" class="nav-list-link">allonet.src.asset</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.src.assetstore.html" class="nav-list-link">allonet.src.assetstore</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.src.client.audio.html" class="nav-list-link">allonet.src.client.audio</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.src.clientproxy.html" class="nav-list-link">allonet.src.clientproxy</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.src.delta.html" class="nav-list-link">allonet.src.delta</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.src.server.html" class="nav-list-link">allonet.src.server</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.test.assetstore_test.html" class="nav-list-link">allonet.test.assetstore_test</a></li><li class="nav-list-item"><a href="/doc/modules/alloui.lua.alloui.json.html" class="nav-list-link">alloui.lua.alloui.json</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Alloverse Documentation" aria-label="Search Alloverse Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/protocol-reference">Protocol Reference</a></li> <li class="breadcrumb-nav-list-item"><span>Asset Protocol</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="asset-protocol"> <a href="#asset-protocol" class="anchor-heading" aria-labelledby="asset-protocol"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Asset Protocol </h1> <p>Assets are delivered between agents by using the placeserv as a distribution center. Channel 2 <code class="language-plaintext highlighter-rouge">CHANNEL_ASSETS</code> is used to deliver reliable messages in any direction. Messages can be requests, responses, informational or raw asset data.</p> <p>“Assets” in this context means static, unchanging data used by clients or other agents, such as textures, 3d models, sound files, etc. Basically, anything that would be distributed as resource files in an app or a game.</p> <p>There are no provisions for editing files, or keeping track of changes. While the asset system could be used to distribute arbitrary file systems; editing, listing and change notifications would have to be implemented as interactions.</p> <h2 id="identity"> <a href="#identity" class="anchor-heading" aria-labelledby="identity"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Identity </h2> <p>Assets are always identified with the format:</p> <p><code class="language-plaintext highlighter-rouge">asset:sha256:&lt;&lt;64 lowercase hex digits&gt;&gt;</code></p> <p>The hex digits are the sha-2 256 bit hash of the full file contents of the asset itself. This means that you can’t have different versions of the same asset on different clients, because then they are in effect different assets.</p> <p>No filename, mime type or any other metadata is provided in the identifier. If this turns out to be essential, we could add it as additional fields, separating fields with colons.</p> <h2 id="distribution"> <a href="#distribution" class="anchor-heading" aria-labelledby="distribution"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Distribution </h2> <p>In general, the distribution protocol uses “pull” semantics from agents that need data. When an agent requests an asset from placeserv, it will first try to serve it from cache to the requesting agent. If none is found, it broadcasts a request to all connected agents to find who has it. Placeserv then retrieves the asset to placeserv’s cache, and then serves the asset back to the requesting agent.</p> <p>The requesting agent might already have a good idea about who has the asset, and MAY include an entity id as a hint to which client SHOULD be asked first (whereafter it MUST ask all other agents to see if they have it).</p> <p>In addition, if an agent has an asset that it thinks is very likely to be needed soon, it MAY push that asset immediately to the placeserv to be stored in the cache.</p> <p>Once an asset is received, it MUST be checked against the hash in its identifier to verify its integrity, and discard it if the hash does not match.</p> <h2 id="caching"> <a href="#caching" class="anchor-heading" aria-labelledby="caching"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Caching </h2> <p>Placeserv MUST function even completely without a cache. In the case of an asset response which doesn’t fit on disk, or an asset response which indicates not cacheable, placeserv must stream this asset directly to the requesting agent, keeping just enough of it in RAM to do so, whereafter it can remove the asset from memory.</p> <h2 id="wire-protocol"> <a href="#wire-protocol" class="anchor-heading" aria-labelledby="wire-protocol"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Wire protocol </h2> <p>On the wire, messages are:</p> <ol> <li><code class="language-plaintext highlighter-rouge">mid</code>, a 16-bit unsigned big-endian integer message type code.</li> <li><code class="language-plaintext highlighter-rouge">hlen</code>, a 16-bit unsigned big-endian integer header length value.</li> <li><code class="language-plaintext highlighter-rouge">header</code>, a utf8 json body of <code class="language-plaintext highlighter-rouge">hlen</code> bytes.</li> <li><code class="language-plaintext highlighter-rouge">message</code>, a raw bytestream of bytes, directly appended after <code class="language-plaintext highlighter-rouge">hlen</code> bytes of json and until the end of the packet.</li> </ol> <h3 id="csc-asset-request"> <a href="#csc-asset-request" class="anchor-heading" aria-labelledby="csc-asset-request"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> C&gt;S&gt;C Asset request </h3> <p>Ask for an asset. The message can be:</p> <ul> <li>agent to placeserv: Ask the place for an asset, in which case it will either respond with it from cache; or ask other agents for the asset and then forward it on.</li> <li>placeserv to agent: Placeserv has been asked by another agent for an asset, and is now forwarding that request.</li> </ul> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;&lt;mid:1&gt;&gt;&lt;&lt;hlen&gt;&gt;{
  "id": "&lt;&lt;asset id&gt;&gt;",
  "range": [start_byte_offset, number_of_bytes],
  "published_by": "&lt;&lt;entity id&gt;&gt;" // optional
}
</code></pre></div></div> <ul> <li><code class="language-plaintext highlighter-rouge">id</code> is the ID of the asset</li> <li><code class="language-plaintext highlighter-rouge">range</code> is the byte range you want. Send <code class="language-plaintext highlighter-rouge">[0, 0]</code> for a head request.</li> <li><code class="language-plaintext highlighter-rouge">published_by</code> is the entity ID whose owner is likely to own the asset. This is an optional field and only used as a hint. Placeserv should ask this agent first, before asking other agents.</li> </ul> <h3 id="csc-asset-response-transmission-header"> <a href="#csc-asset-response-transmission-header" class="anchor-heading" aria-labelledby="csc-asset-response-transmission-header"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> C&gt;S&gt;C Asset response, transmission header </h3> <p>If the receiver has the asset requested, it may respond affirmative with the metadata of the asset in a “transmission header” packet. It will then commence sending “transmission chunks”.</p> <p>An agent can start sending this to a placeserv (or placeserv to an agent) unprompted in case it wishes to warm up the receiver’s cache.</p> <p>Once we receive <code class="language-plaintext highlighter-rouge">start_byte_offset + number_of_bytes == total_length</code> the full asset has been received. The receiver should start confirming the hash of the asset before finally storing it in its cache and forwarding it to the application layer.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;&lt;mid:2&gt;&gt;&lt;&lt;hlen&gt;&gt;{
  "id": "&lt;&lt;asset id&gt;&gt;",
  "range": [start_byte_offset, number_of_bytes],
  "total_length": &lt;&lt;total byte length of asset&gt;&gt;,
}&lt;&lt;raw data&gt;&gt;
</code></pre></div></div> <h3 id="csc-asset-response-failure-header"> <a href="#csc-asset-response-failure-header" class="anchor-heading" aria-labelledby="csc-asset-response-failure-header"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> C&gt;S&gt;C Asset response, failure header </h3> <p>Sent in place of <code class="language-plaintext highlighter-rouge">mid:2</code> in case the receiver is unable to satisfy the request (e g it doesn’t have the asset).</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;&lt;mid:3&gt;&gt;&lt;&lt;hlen&gt;&gt;{
  "id": "&lt;&lt;asset id&gt;&gt;",
  "error_reason": "&lt;&lt;user-readable unavailability reason&gt;&gt;",
  "error_code": "&lt;&lt;computer-reladable error code for this error&gt;&gt;",
}
</code></pre></div></div> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
