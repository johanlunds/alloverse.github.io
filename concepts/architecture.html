<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Alloverse Architecture - Alloverse Documentation</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Alloverse Architecture | Alloverse Documentation</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="Alloverse Architecture" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Getting started with Alloverse. Guides, code snippets, API references…" /> <meta property="og:description" content="Getting started with Alloverse. Guides, code snippets, API references…" /> <link rel="canonical" href="/concepts/architecture" /> <meta property="og:url" content="/concepts/architecture" /> <meta property="og:site_name" content="Alloverse Documentation" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Alloverse Architecture" /> <script type="application/ld+json"> {"description":"Getting started with Alloverse. Guides, code snippets, API references…","url":"/concepts/architecture","@type":"WebPage","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/images/Alloverse01.png"}},"headline":"Alloverse Architecture","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="/" class="nav-list-link">Get Started</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/concepts" class="nav-list-link">Concepts</a><ul class="nav-list "><li class="nav-list-item active"><a href="/concepts/architecture" class="nav-list-link active">Alloverse Architecture</a></li><li class="nav-list-item "><a href="/concepts/points-pokes-and-grabs" class="nav-list-link">Points, Pokes and Grabs</a></li><li class="nav-list-item "><a href="/concepts/writing-apps-with-alloUI" class="nav-list-link">Writing apps with AlloUI</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/examples" class="nav-list-link">Examples</a><ul class="nav-list "><li class="nav-list-item "><a href="/concepts/animating-views" class="nav-list-link">Animating Views</a></li><li class="nav-list-item "><a href="/concepts/assets" class="nav-list-link">Assets</a></li></ul></li><li class="nav-list-item"><a href="/hig" class="nav-list-link">3D Human Interface Guidelines</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/classes/" class="nav-list-link">Classes</a><ul class="nav-list "></ul></li><li class="nav-list-item"><a href="/modules/" class="nav-list-link">Modules</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/protocol-reference" class="nav-list-link">Protocol Reference</a><ul class="nav-list "><li class="nav-list-item "><a href="/protocol-reference/asset-protocols" class="nav-list-link">Asset Protocol</a></li><li class="nav-list-item "><a href="/protocol-reference/coordinate-system" class="nav-list-link">Coordinate System</a></li><li class="nav-list-item "><a href="/protocol-reference/identity" class="nav-list-link">Identity</a></li><li class="nav-list-item "><a href="/protocol-reference/intent" class="nav-list-link">Intent</a></li><li class="nav-list-item "><a href="/protocol-reference/interactions" class="nav-list-link">Interactions</a></li><li class="nav-list-item "><a href="/protocol-reference/official-components" class="nav-list-link">Official Components</a></li><li class="nav-list-item "><a href="/protocol-reference/state-diffs" class="nav-list-link">State Diffs</a></li><li class="nav-list-item "><a href="/protocol-reference/url-definitions" class="nav-list-link">URL Definitions</a></li><li class="nav-list-item "><a href="/protocol-reference/wire-protocol" class="nav-list-link">Wire Protocol</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="/community" class="nav-list-link">Community</a><ul class="nav-list "><li class="nav-list-item "><a href="/community/contributing" class="nav-list-link">Contributing to Alloverse</a></li><li class="nav-list-item "><a href="/community/code-of-conduct.html" class="nav-list-link">Code of Conduct</a></li><li class="nav-list-item "><a href="/community/licenses" class="nav-list-link">Licenses used by Alloverse</a></li><li class="nav-list-item "><a href="/community/alloverse-license.html" class="nav-list-link">Alloverse License</a></li></ul></li><li class="nav-list-item"><a href="/doc/classes/Asset.html" class="nav-list-link">Asset</a></li><li class="nav-list-item"><a href="/doc/classes/AssetManager.html" class="nav-list-link">AssetManager</a></li><li class="nav-list-item"><a href="/doc/classes/AssetView.html" class="nav-list-link">AssetView</a></li><li class="nav-list-item"><a href="/doc/classes/Base64Asset.html" class="nav-list-link">Base64Asset</a></li><li class="nav-list-item"><a href="/doc/classes/Button.html" class="nav-list-link">Button</a></li><li class="nav-list-item"><a href="/doc/classes/FileAsset.html" class="nav-list-link">FileAsset</a></li><li class="nav-list-item"><a href="/doc/classes/GrabHandle.html" class="nav-list-link">GrabHandle</a></li><li class="nav-list-item"><a href="/doc/" class="nav-list-link">Index</a></li><li class="nav-list-item"><a href="/doc/classes/Label.html" class="nav-list-link">Label</a></li><li class="nav-list-item"><a href="/doc/classes/Speaker.html" class="nav-list-link">Speaker</a></li><li class="nav-list-item"><a href="/doc/classes/Surface.html" class="nav-list-link">Surface</a></li><li class="nav-list-item"><a href="/doc/classes/TextField.html" class="nav-list-link">TextField</a></li><li class="nav-list-item"><a href="/doc/classes/View.html" class="nav-list-link">View</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.include.allonet.assetstore.html" class="nav-list-link">allonet.include.allonet.assetstore</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.include.allonet.client.html" class="nav-list-link">allonet.include.allonet.client</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.include.allonet.jobs.html" class="nav-list-link">allonet.include.allonet.jobs</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.include.allonet.state.html" class="nav-list-link">allonet.include.allonet.state</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.lang.lua.allonet-lua.html" class="nav-list-link">allonet.lang.lua.allonet-lua</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.lang.lua.json.html" class="nav-list-link">allonet.lang.lua.json</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.lang.lua.lua-utils.html" class="nav-list-link">allonet.lang.lua.lua-utils</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.src.asset.html" class="nav-list-link">allonet.src.asset</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.src.assetstore.html" class="nav-list-link">allonet.src.assetstore</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.src.client.audio.html" class="nav-list-link">allonet.src.client.audio</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.src.clientproxy.html" class="nav-list-link">allonet.src.clientproxy</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.src.delta.html" class="nav-list-link">allonet.src.delta</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.src.server.html" class="nav-list-link">allonet.src.server</a></li><li class="nav-list-item"><a href="/doc/modules/allonet.test.assetstore_test.html" class="nav-list-link">allonet.test.assetstore_test</a></li><li class="nav-list-item"><a href="/doc/modules/alloui.lua.alloui.json.html" class="nav-list-link">alloui.lua.alloui.json</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Alloverse Documentation" aria-label="Search Alloverse Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="/concepts">Concepts</a></li> <li class="breadcrumb-nav-list-item"><span>Alloverse Architecture</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="alloverse-architecture"> <a href="#alloverse-architecture" class="anchor-heading" aria-labelledby="alloverse-architecture"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Alloverse Architecture </h1> <p>This document explains the various concepts. For exact protocol specifications, see the <a href="/protocol-reference">Protocol Reference</a>.</p> <h2 id="basic-premises"> <a href="#basic-premises" class="anchor-heading" aria-labelledby="basic-premises"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Basic premises </h2> <ul> <li>Your “place” is where you decorate, run apps, invite people, and hang out. It’s like a collaborative X11 server: It runs a world simulation server, a voip gateway, and all the backing data for 3d UIs for the running apps.</li> <li>A “visor” is the GUI application you use to visit places and interact with your apps.</li> <li>An “appliance” is a process running on your computer, or on a computer on the Internet. Like opening a web page (or launching a remote X11 process), this app can then show its interface and be interacted with inside your place.</li> </ul> <p>A place, a user/visor and appliances are all actors using the same network protocol and RPC mechanics, implemented in the <code class="language-plaintext highlighter-rouge">allonet</code> library.</p> <p><img src="/assets/images/allonet.png" alt="allonet" /></p> <p>Streams:</p> <ul> <li>The “state stream” sends the place’s representation once every server heartbeat. Right now, it sends the entire state, but the plan is to send only a diff from the last-acknowledged-state for each client. It’s a JSON object of Entities and their properties.</li> <li>The “intent stream” sends the client or appliance’s movement intents and related data on every heartbeat. It’s a JSON object with relative movement intents and absolute orientation requests; details on controller position, orientation and state; and an ack of the last successfully received state.</li> <li>Interactions are JSON lists, with a sender entity and receiver entity.</li> <li>Asset distribution</li> <li>Media streams are unreliable data streams, e g audio (for voice chat), video/textures (screen sharing etc) and geometry (for advanced appliance representations).</li> </ul> <p>Allonet multiplexes these over UDP using <code class="language-plaintext highlighter-rouge">enet</code>. The plan is to wrap this in TLS.</p> <p>An alternative plan has been to use WebRTC as the transport for free TLS, ICE, udp punch-through, etc. We might still do that in the future, if a nice open source library appears.</p> <h2 id="entities-and-the-place-state"> <a href="#entities-and-the-place-state" class="anchor-heading" aria-labelledby="entities-and-the-place-state"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Entities and the place state </h2> <p>Entities are things in the world, represented in a scene graph. An entity has only an “id” and a list of components. There is a <a href="/protocol-reference/official-components">list of specifications for official components</a>. Apps may invent additional components without them having to be part of the standard.</p> <h2 id="interactions-and-access-control"> <a href="#interactions-and-access-control" class="anchor-heading" aria-labelledby="interactions-and-access-control"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Interactions and access control </h2> <p>Interactions are the way entities can communicate, including how the visor talks to the place itself (by sending to entity id <code class="language-plaintext highlighter-rouge">place</code>). It’s a json list for now, and the idea is for it to be a pub-sub request-response protocol vaguley inspired by <a href="http://www.doc.ic.ac.uk/~klc/pedro.pdf">Peter J Robinson et al’s Pedro protocol</a>.</p> <p>The documentation has a <a href="/protocol-reference/interactions">list of specifications for official interactions</a>, but again, apps and visors can invent their own beyond the specification.</p> <p>The alloplace server becomes the Pedro gateway, and can thus manage access control lists, defined as guard expressions on the expression itself, the sender and the receiver. See <a href="https://github.com/alloverse/alloplace/issues/2">the implementation task</a> for more information.</p> <p>These ACLs can then control everything needed:</p> <ul> <li>An ACL on the “announce” packet allows place owners to restrict access to specific users</li> <li>An ACL on the “spawn” packet allows place owners to permit only specific users and appliances to manifest in the place</li> <li>An ACL on the “acl-modify” packet allows place owners to restrict access to the ACL itself to moderators/owners only.</li> </ul> <p>This should be exposed in the visor as much more user friendly than the bullet list above makes it seem…</p> <h2 id="the-three-components"> <a href="#the-three-components" class="anchor-heading" aria-labelledby="the-three-components"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The three components </h2> <h3 id="alloplace"> <a href="#alloplace" class="anchor-heading" aria-labelledby="alloplace"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Alloplace </h3> <p>The alloplace server holds all the state and takes care of all the logic. It is the world state, RPC and media transit hub.</p> <ul> <li>runs a game loop, with physics simulation, intent interpretation, etc.</li> <li>pulses diffs to any actors that want it (primarily visors),</li> <li>is RPC router between actors (place, visors and apps), including app&lt;&gt;app</li> <li>does ACL permission checks on all RPC</li> <li>simulates the physical bodies in the place</li> <li>Manages at least one physical+visual body for each actor,</li> <li>Allows actors to create additional entities</li> </ul> <h3 id="visor"> <a href="#visor" class="anchor-heading" aria-labelledby="visor"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Visor </h3> <p>I’d love to support different visors: VR, AR desktop 3D and touch. For now, the focus is on the VR visor in Lovr.</p> <p><code class="language-plaintext highlighter-rouge">alloplace://(enet endpoint)...</code> URLs can be opened to make a visor open a place (<a href="https://github.com/alloverse/allovisor/issues/1">when that’s implemented</a>).</p> <p>A visor should provide some sort of client identity. The idea for now is for each client to provide a public certificate with a name bound to it, so you can at least know when the same client appears again. Would love an architecture idea for a distributed identity plan (web of trust?).</p> <p>If we end up going with webrtc, the enet endpoint should be replaced with a https endpoint that takes a <code class="language-plaintext highlighter-rouge">POST</code> of the SDP for an <code class="language-plaintext highlighter-rouge">OFFER</code>, and responds with the <code class="language-plaintext highlighter-rouge">ANSWER</code>.</p> <h3 id="appliances"> <a href="#appliances" class="anchor-heading" aria-labelledby="appliances"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Appliances </h3> <p>Appliances are written in any language and interact with the <code class="language-plaintext highlighter-rouge">allonet</code> library acting as a “UIKit” for XR UI.</p> <p><img src="/assets/images/alloui.png" alt="alloui" /></p> <p>While appliances can use the allonet API directly, it uses low-level primitives that are not great for building 3D UIs. The plan is to create an “Allo UI” UI kit API on top of allonet that spawns entities, shares textures etc as necessary to provide the <a href="writing-apps-with-alloUI">UX and UI interactions that Alloverse standardizes on</a>, providing an intuitive and uniform experience across appliances without every application developer having to think of their own interaction patterns.</p> <p>If a user opens an <code class="language-plaintext highlighter-rouge">alloapp+http(s)://...</code>, it should be opened by the visor. The visor should then send an interaction to the alloplace server, asking it to spawn the given appliance.</p> <p>The alloplace server should then make the http(s) call to the given URL with a connection instruction json blob:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "spawnInPlace": "alloplace://hostname:port",
  "onBehalfOf": (client identity),
  "query": (query params as-is from the alloapp url)
}.
</code></pre></div></div> <p>The http server receiving this request should then spawn a process for this agent and have it connect to the <code class="language-plaintext highlighter-rouge">spawnInPlace</code> URL. See <a href="https://github.com/alloverse/alloplace/issues/8">the implementation task for opening appliances with URLs</a>.</p> <p>The plan is to provide a generic “alloapp gateway” node script that responds to requests like the one above which can be easily configured to spawn a process like the above, so that all an app developer needs to implement is a process that takes a place URL in ENV (or the whole json as above), and then asks the allonet API to connect to that URL.</p> <h2 id="assets"> <a href="#assets" class="anchor-heading" aria-labelledby="assets"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Assets </h2> <p>Entities should have components representing assets such as:</p> <ul> <li>mesh/model</li> <li>textures</li> <li>animations</li> <li>static sounds</li> </ul> <p>They should reference these assets by sha1 hash. When a alloplace server sees a new hash in the description of an entity coming from an agent, it should ask that agent for that asset hash over the asset channel. The agent should then stream the asset to the server for caching and redelivery.</p> <p>When another agent then sees the references to the assets, it can thus then ask the alloplace for the corresponding asset, so that it can then later display it.</p> <p>Dynamic textures and audio will later be represented as webrtc streams, and thus not considered assets the same way. Placeserv then acts as an SFU.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
